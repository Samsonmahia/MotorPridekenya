<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Used Cars | MotorPride Kenya</title>
<style>
body { font-family: Arial, sans-serif; background:#f5f7fa; margin:0; padding:0; }
h2 { text-align:center; color:#0A1F44; margin:30px 0; font-size:28px; }

/* Vehicle Grid */
.vehicle-grid {
  display: grid;
  grid-template-columns: repeat(3, 1fr);
  gap: 20px;
  padding: 20px;
  max-width: 1200px;
  margin: auto;
}
@media(max-width:992px){ .vehicle-grid { grid-template-columns: repeat(2, 1fr); } }
@media(max-width:600px){ .vehicle-grid { grid-template-columns: 1fr; } }

.vehicle-card {
  background: #fff;
  border-radius: 12px;
  box-shadow: 0 4px 12px rgba(0,0,0,0.1);
  overflow: hidden;
  cursor: pointer;
  transition: transform 0.3s ease;
}
.vehicle-card:hover { transform: translateY(-6px); }
.vehicle-card img { width:100%; height:200px; object-fit:cover; }
.vehicle-info { padding:15px; text-align:center; }
.vehicle-info h3 { margin:5px 0; font-size:18px; color:#0A1F44; }
.vehicle-info p { margin:4px 0; color:#333; font-size:14px; }

.modal { display:none; position:fixed; z-index:1000; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.7); overflow-y:auto; }
.modal-content { background:#fff; margin:30px auto; padding:20px; border-radius:12px; width:90%; max-width:1000px; text-align:center; position:relative; display:flex; flex-direction: column; }
.close { position:absolute; right:15px; top:10px; font-size:28px; cursor:pointer; }

.modal-body { display:flex; flex-direction: column; }
@media(min-width:768px){ .modal-body { flex-direction: row; gap:20px; } }

#modalMainImage { width:100%; max-height:450px; object-fit:cover; border-radius:10px; margin-bottom:15px; }

.thumbnails { display:flex; flex-wrap:wrap; gap:10px; justify-content:center; margin-bottom:15px; }
@media(min-width:768px){ .thumbnails { flex-direction: column; max-height:450px; overflow-y:auto; margin:0; } }

.thumbnails img { width:110px; height:80px; object-fit:cover; border-radius:8px; cursor:pointer; transition: transform 0.2s; }
.thumbnails img:hover, .thumbnails img.active { transform: scale(1.08); border:2px solid #00AEEF; }

#modalSpecs { text-align:left; margin-top:10px; font-size:14px; }
#modalSpecs p { margin:5px 0; }
.reserve-btn { display:inline-block; margin-top:10px; padding:10px 20px; background:#25D366; color:#fff; border-radius:8px; text-decoration:none; }

.pagination { text-align:center; margin:30px 0; }
.pagination button { padding:10px 16px; margin:5px; border:none; border-radius:6px; background:#0A1F44; color:#fff; cursor:pointer; }
.pagination button:disabled { background:#ccc; cursor:default; }
</style>
</head>
<body>

<h2>USED CARS</h2>
<div id="carGrid" class="vehicle-grid"></div>

<!-- Pagination -->
<div class="pagination">
  <button id="prevBtn" onclick="changePage(-1)">Prev</button>
  <button id="nextBtn" onclick="changePage(1)">Next</button>
</div>

<!-- Modal -->
<div id="carModal" class="modal">
  <div class="modal-content">
    <span class="close" onclick="closeModal()">&times;</span>
    <div class="modal-body">
      <div style="flex:1;">
        <img id="modalMainImage" src="" alt="Car" />
        <div id="modalThumbnails" class="thumbnails"></div>
      </div>
      <div id="modalSpecs" style="flex:1;"></div>
    </div>
  </div>
</div>

<script>
let vehicles = [];
let currentPage = 1;
const carsPerPage = 12;

// Fetch JSON from CMS folder
fetch('/content/used-cars/used-cars.json')
  .then(res => res.json())
  .then(data => {
    vehicles = data;
    renderCars();
  })
  .catch(err => console.error('Failed to load cars JSON:', err));

function renderCars() {
  const carGrid = document.getElementById("carGrid");
  carGrid.innerHTML = "";
  const start = (currentPage - 1) * carsPerPage;
  const end = start + carsPerPage;
  const paginated = vehicles.slice(start, end);

  paginated.forEach(car => {
    const card = document.createElement("div");
    card.className = "vehicle-card";
    card.onclick = () => openModal(car);
    card.innerHTML = `
      <img src="${car.images[0]}" alt="${car.name}">
      <div class="vehicle-info">
        <h3>${car.name}</h3>
        <p><strong>Year:</strong> ${car.year}</p>
        <p><strong>Price:</strong> ${car.price}</p>
      </div>
    `;
    carGrid.appendChild(card);
  });

  document.getElementById("prevBtn").disabled = currentPage === 1;
  document.getElementById("nextBtn").disabled = (currentPage * carsPerPage) >= vehicles.length;
}

function changePage(direction) {
  currentPage += direction;
  renderCars();
}

const modal = document.getElementById("carModal");
const modalMainImage = document.getElementById("modalMainImage");
const modalThumbnails = document.getElementById("modalThumbnails");
const modalSpecs = document.getElementById("modalSpecs");

function openModal(car) {
  modal.style.display = "block";
  modalMainImage.src = car.images[0];
  modalThumbnails.innerHTML = "";
  car.images.forEach((img, index) => {
    const thumb = document.createElement("img");
    thumb.src = img;
    if(index === 0) thumb.classList.add("active");
    thumb.onclick = () => {
      modalMainImage.src = img;
      document.querySelectorAll(".thumbnails img").forEach(t => t.classList.remove("active"));
      thumb.classList.add("active");
    };
    modalThumbnails.appendChild(thumb);
  });

  modalSpecs.innerHTML = `
    <h3>${car.name}</h3>
    <p><strong>Fuel:</strong> ${car.fuel}</p>
    <p><strong>Year:</strong> ${car.year}</p>
    <p><strong>Transmission:</strong> ${car.transmission}</p>
    <p><strong>Engine:</strong> ${car.engine}</p>
    <p><strong>Mileage:</strong> ${car.mileage}</p>
    <p><strong>Color:</strong> ${car.color}</p>
    <p><strong>Features:</strong> ${car.features.join(", ")}</p>
    <a href="https://wa.me/254723098206?text=I want to reserve ${encodeURIComponent(car.name)}"
       class="reserve-btn" target="_blank">Reserve via WhatsApp</a>
  `;
}

function closeModal() { modal.style.display = "none"; }
</script>

</body>
</html>
